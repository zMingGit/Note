## 更新索引脚本优化:
    耗费最多的为提取text文本内容的操作，占用1/2的时间, 网上测评pdftextstream相对于pdftotext性能优化25%，基于1000个pdf的测评，这两个库都无错误，pdftotext还有些警告。  

    然后就是添加文件的时候循环操作和更新索引操作。占用3/10的时间。

    剩下没计算时间的操作为对资料库的diff操作，以及对资料库状态索引检查和更新的操作。

* 现在是对每一个资料库回去检查资料库的状态是否需要更新，可以改为批量查询多个记录，同样的，对于这次批量查询中不存在的资料库，则将一条一条添加改为批量添加。 
* 拿到解析的text内容后，会去搜索一次文件，判断是否存在，然后不存在添加索引，存在则部分更新索引，这一部分对es的操作也可以用批量去做。
* 添加文件到索引、添加文件夹到索引、索引中删除文件、索引中删除文件夹都可以改为添加到批量操作列表中，再执行批量操作。




dev 测试:
```
[09/20/2017 08:11:21] latest_commit_id: ab6b3de2c439d4f4aa98118d95c233f47d3bafdb, status.from_commit: None
[09/20/2017 08:11:21] add total time: 3787.82992935
[09/20/2017 08:11:21] other total time: 90.3270041943
[09/20/2017 08:11:21] extract total time: 2445.81596136
[09/20/2017 08:11:21] ready extract total time: 2.63440942764
[09/20/2017 08:11:21] total time: 4432.22636104
```

[09/21/2017 10:05:36] add total time: 3453.75043988
[09/21/2017 10:05:36] other total time: 80.6850619316
[09/21/2017 10:05:36] seafile diff total time: 482.908272743
[09/21/2017 10:05:36] ready extract total time: 2.15857076645
[09/21/2017 10:05:36] extract total time: 2811.56527448
[09/21/2017 10:05:36] es add total time: 247.023511887
[09/21/2017 10:05:36] es query total time: 381.565234661
[09/21/2017 10:05:36] es update total time: 0
[09/21/2017 10:05:36] total time: 4065.79199815

[09/21/2017 15:44:19] add total time: 4489.04818964
[09/21/2017 15:44:19] other total time: 118.088065624
[09/21/2017 15:44:19] seafile diff total time: 540.190306425
[09/21/2017 15:44:19] extract total time: 3011.0950048
[09/21/2017 15:44:19] es operation total time: 1458.80739784
[09/21/2017 15:44:19] ready extract total time: 3.05978631973
[09/21/2017 15:44:19] total time: 2681.30133605

2551



测评文章；
https://www.snowtide.com/performance 但是有500次的限制，超过以后需要重启服务或软件。