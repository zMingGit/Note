### 准备:

1. 安装redis
2. 安装redis对于python的库


下载redis的stable版本的源代码文件

```
tar -zxvf redis-stable.tar.gz
. utils/install_server.sh[交互式执行，选择端口、配置文件路径等配置]
```

执行完成，在对应的配置文件中添加redis的密码

```
requirepass password
```

安装redis对应python的库

```
pip install redis==2.10.6
```





### seafevent 节点

`conf/events.conf`:

```
[EVENTS PUBLISH]
mq_type=redis
enabled = true

[REDIS]
server = 172.31.19.106
port = 6379
password = hello123
```


#### 运行

在`seafile-server-last`目录下执行`./seafile.sh start`启动前端节点上的seafevents程序.

### seafes 主节点

`conf/index-master.conf`

```
[DEFAULT]
mq_type = redis

[REDIS]
server = 172.31.19.106
password = hello123
port = 6379
```

#### 运行

在`seafile-server-last`目录下执行`./run_index_master.sh [start/stop/restart]` 去控制程序运行、停止和重启

### seafes 从节点

`conf/index-slave.conf`

```
[DEFAULT]
mq_type = redis
index_workers = 2

[REDIS]
server = 172.31.19.106
password = hello123
port = 6379
```

#### 运行

在`seafile-server-last`目录下执行`./run_index_worker.sh [start/stop/restart]` 控制worker程序的开始、停止、重启.

## 关闭seafile-backgroun中的自动间隔更新索引

### 由于自动更新索引和现在的实时索引会冲突，所以需要关闭自动更新索引任务. icourt的seafile-backgroun任务只需要索引，所以在后端节点上干脆不运行background的shell脚本，直接运行run_index_master和run_index_worker脚本.
